import * as ink from 'https://deno.land/x/ink/mod.ts'

import { show } from '../../utils/show.ts'
import { utils } from '../../utils/utils.ts'
const _show = new show()
const _utils = new utils()


export class WebExploit {

    public async init(){
        _show.log('Starting web exploit...')
        await this.main()
    }

    private async main() {
        //show the main menu
        await _show.show_web_exploit_menu()
        let rep = await _utils.listenUserResponse(ink.colorize("[<red>You</red>] your choice: "))
        if (rep == "1") {
            _show.log('Finding subdomain...')
            await this.findSubdomain()
        } else if(rep == "@") {
            return
        } else {
            _show.log('Invalid choice')
        }
        await this.main()
    }

    //private part
    private async findSubdomain() {
        let maindomain = await _utils.listenUserResponse(ink.colorize("[<red>You</red>] enter the domain: "))
        let regex = /[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9](?:\.[a-zA-Z]{2,})/g
        if (maindomain.match(regex)) {
            _show.log(`Searching subdomain of ${maindomain}`)
            let t = await (await import('./tools/findSub.ts')).findSubdomain(maindomain)
            console.table(t)
        } else {
            _show.log('Invalid domain format')
            await this.findSubdomain()
        }
    }
}