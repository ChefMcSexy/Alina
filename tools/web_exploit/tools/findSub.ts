export async function findSubdomain(domain){
    let rep = []
    rep = await getDomainViaSSL(domain)


    for(let i = 0; i < rep.length; i++){
        rep[i].seen = rep[i].seen.sort().reverse()[0]
    }

    return rep
}


/**
 * 
 * Exploit https://crt.sh for subdomain
 */
async function getDomainViaSSL(domain) {
    let rep = []

    let req = await fetch(`https://crt.sh/?q=${domain}&output=json`)
    let response = await req.json()
    for(let i = 0; i < response.length; i++){
        let allD = response[i].name_value.split('\n')
        for(let j = 0; j < allD.length; j++){
            let t = rep.find(x => x.domain == allD[j])
            if(!t){
                rep.push({
                    domain: allD[j],
                    seen: [response[i].entry_timestamp]
                })
            } else {
                t.seen.push(response[i].entry_timestamp)
            }
        }
    }

    return rep
}